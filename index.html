<!DOCTYPE HTML>
<HTML lang="kr">
<head>
    <meta charset="utf-8">
    <title>test102</title>
    <style>
        #mapwrap {
            position: relative;
            overflow: hidden;
        }

        .category,
        .category * {
            margin: 0;
            padding: 0;
            color: #000;
        }

        .category {
            position: absolute;
            overflow: hidden;
            top: 10px;
            left: 10px;
            width: 250px;
            height: 50px;
            z-index: 10;
            border: 1px solid black;
            font-family: 'Malgun Gothic', '맑은 고딕', sans-serif;
            font-size: 12px;
            text-align: center;
            background-color: #fff;
        }

        .category .menu_selected {
            background: #FF5F4A;
            color: #fff;
            border-left: 1px solid #915B2F;
            border-right: 1px solid #915B2F;
            margin: 0 -1px;
        }

        .category li {
            list-style: none;
            float: left;
            width: 60px;
            height: 45px;
            padding-top: 5px;
            cursor: pointer;
        }

        .category .ico_comm {
            display: block;
            margin: 0 auto 2px;
            width: 22px;
            height: 26px;
            background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/category.png') no-repeat;
        }

        .category .ico_coffee {
            background-position: -10px 0;
        }

        .category .ico_store {
            background-position: -10px -36px;
        }

        .category .ico_carpark {
            background-position: -10px -72px;
        }
        
        .category .ico_all {
            background-position: -10px -108px;
        }

        /* 추가된 스타일 */
        #toggleUI {
            position: absolute;
            bottom: 10px;
            left: 10px;
            z-index: 20;
            padding: 5px 10px;
            background-color: #fff;
            border: 1px solid #000;
            cursor: pointer;
        }

        .customoverlay {
            position: absolute;
            bottom: 27px;
            left: -50px;
            display: none;
            width: 300px;
            height: auto;
            padding: 10px;
            background-color: #f0f0f0;
            border: 1px solid #909090;
            border-radius: 6px;
            box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1);
        }

        .customoverlay .title {
            display: block;
            width: 100%;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .customoverlay .close {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }

        .customoverlay img {
            float: left;
            margin-right: 10px;
            width: 80px;
            height: 80px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
<div id="map" style="width: 100%; height: 100% !important; padding-bottom: 50%; position: relative;"></div>

<!-- 지도 위에 표시될 마커 카테고리 -->
<div class="category">
    <ul>
        <li id="coffeeMenu" onclick="changeMarker('coffee')">
            <span class="ico_comm ico_coffee"></span>
            커피숍
        </li>
        <li id="storeMenu" onclick="changeMarker('store')">
            <span class="ico_comm ico_store"></span>
            편의점
        </li>
        <li id="carparkMenu" onclick="changeMarker('carpark')">
            <span class="ico_comm ico_carpark"></span>
            주차장
        </li>
        <li id="allMenu" onclick="changeMarker('all')">
            <span class="ico_comm ico_all"></span>
            모두
        </li>
    </ul>
</div>

<!-- 검색 폼 추가 -->
<div style="position: absolute; top: 70px; left: 10px; z-index: 10; background-color: white; padding: 10px; border: 1px solid black;">
    <form id="searchForm">
        <label for="latitude">위도: </label><input type="text" id="latitude" name="latitude" required><br>
        <label for="longitude">경도: </label><input type="text" id="longitude" name="longitude" required><br>
        <label for="category">카테고리: </label>
        <select id="category" name="category">
            <option value="coffee">커피숍</option>
            <option value="store">편의점</option>
            <option value="carpark">주차장</option>
        </select><br>
        <label for="info">추가 정보: </label><input type="text" id="info" name="info"><br>
        <button type="button" onclick="addMarker()">추가</button>
        <button type="button" onclick="moveToCoordinates()">위치로 이동</button>
        <button type="button" onclick="clearMarkers()">마커 초기화</button>
    </form>
</div>

<!-- UI 숨기기/보이기 버튼 -->
<div id="toggleUI" onclick="toggleUI()">UI 숨기기</div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=da010f91e59f856e4b8d54937ba756b6"></script>
<script>
    var mapContainer = document.getElementById('map'),
        mapOption = {
            center: new kakao.maps.LatLng(37.499590490909185, 127.0263723554437),
            level: 5
        };

    var map = new kakao.maps.Map(mapContainer, mapOption);

    var coffeePositions = [
        new kakao.maps.LatLng(37.499590490909185, 127.0263723554437),
        new kakao.maps.LatLng(37.499427948430814, 127.02794423197847),
        new kakao.maps.LatLng(37.498553760499505, 127.02882598822454),
        new kakao.maps.LatLng(37.497625593121384, 127.02935713582038),
        new kakao.maps.LatLng(37.49646391248451, 127.02675574250912),
        new kakao.maps.LatLng(37.49629291770947, 127.02587362608637),
        new kakao.maps.LatLng(37.49754540521486, 127.02546694890695)
    ];

    var coffeeInfo = [
        {
            관리번호: "001",
            주소: "부림동 52-1",
            회전형: "O",
            고정형: "X",
            상세설명: "커피맛집입니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        },
        {
            관리번호: "002",
            주소: "부림동 110-1",
            회전형: "O",
            고정형: "X",
            상세설명: "커피 좋아요.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        },
        {
            관리번호: "003",
            주소: "부림동 140-1",
            회전형: "O",
            고정형: "X",
            상세설명: "커피 파는 곳입니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        },
        {
            관리번호: "004",
            주소: "부림동 120-1",
            회전형: "O",
            고정형: "X",
            상세설명: "커피 전문점입니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        },
        {
            관리번호: "005",
            주소: "부림동 122-221",
            회전형: "O",
            고정형: "X",
            상세설명: "커피 카페입니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        },
        {
            관리번호: "006",
            주소: "부림동 540-1",
            회전형: "O",
            고정형: "X",
            상세설명: "커피 좋아해요.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        },
        {
            관리번호: "007",
            주소: "부림동 1340-1",
            회전형: "O",
            고정형: "X",
            상세설명: "커피 좋습니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        }
    ];

    var storePositions = [
        new kakao.maps.LatLng(37.497535461505684, 127.02948149502778),
        new kakao.maps.LatLng(37.49671536281186, 127.03020491448352),
        new kakao.maps.LatLng(37.496201943633714, 127.02959405469642),
        new kakao.maps.LatLng(37.49640072567703, 127.02726459882308),
        new kakao.maps.LatLng(37.49640098874988, 127.02609983175294),
        new kakao.maps.LatLng(37.49932849491523, 127.02935780247945),
        new kakao.maps.LatLng(37.49996818951873, 127.02943721562295)
    ];

    var storeInfo = [
        {
            관리번호: "101",
            주소: "중앙동 52-1",
            회전형: "O",
            고정형: "X",
            상세설명: "편의점입니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        },
        {
            관리번호: "102",
            주소: "과천동 110-1",
            회전형: "O",
            고정형: "X",
            상세설명: "편의점입니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        },
        {
            관리번호: "103",
            주소: "중앙동 140-1",
            회전형: "O",
            고정형: "X",
            상세설명: "편의점입니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        },
        {
            관리번호: "104",
            주소: "과천동 120-1",
            회전형: "O",
            고정형: "X",
            상세설명: "편의점입니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        },
        {
            관리번호: "105",
            주소: "과천동 122-221",
            회전형: "O",
            고정형: "X",
            상세설명: "편의점입니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        },
        {
            관리번호: "106",
            주소: "과천동 540-1",
            회전형: "O",
            고정형: "X",
            상세설명: "편의점입니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        },
        {
            관리번호: "107",
            주소: "과천동 1340-1",
            회전형: "O",
            고정형: "X",
            상세설명: "편의점입니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        }
    ];

    var carparkPositions = [
        new kakao.maps.LatLng(37.49966168796031, 127.03007039430118),
        new kakao.maps.LatLng(37.499463762912974, 127.0288828824399),
        new kakao.maps.LatLng(37.49896834100913, 127.02833986892401),
        new kakao.maps.LatLng(37.49893267508434, 127.02673400572665),
        new kakao.maps.LatLng(37.49872543597439, 127.02676785815386),
        new kakao.maps.LatLng(37.49813096097184, 127.02591949495914),
        new kakao.maps.LatLng(37.497680616783086, 127.02518427952202)
    ];

    var carparkInfo = [
        {
            관리번호: "201",
            주소: "문원동 52-1",
            회전형: "O",
            고정형: "X",
            상세설명: "주차장입니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        },
        {
            관리번호: "202",
            주소: "문원동산 110-1",
            회전형: "O",
            고정형: "X",
            상세설명: "주차장입니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        },
        {
            관리번호: "203",
            주소: "혜화역 140-1",
            회전형: "O",
            고정형: "X",
            상세설명: "주차장입니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        },
        {
            관리번호: "204",
            주소: "과천Ic 120-1",
            회전형: "O",
            고정형: "X",
            상세설명: "주차장입니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        },
        {
            관리번호: "205",
            주소: "부림동 122-221",
            회전형: "O",
            고정형: "X",
            상세설명: "주차장입니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        },
        {
            관리번호: "206",
            주소: "부림동 540-1",
            회전형: "O",
            고정형: "X",
            상세설명: "주차장입니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        },
        {
            관리번호: "207",
            주소: "과천동 1340-1",
            회전형: "O",
            고정형: "X",
            상세설명: "주차장입니다.",
            이미지: "https://dummyimage.com/80x80/ccc/000.jpg"
        }
    ];

    var coffeeMarkerImageSrc = 'https://raw.githubusercontent.com/summ7569/summ7569.github.io/master/category1.png';
    var storeMarkerImageSrc = 'https://raw.githubusercontent.com/summ7569/summ7569.github.io/master/category2.png';
    var carparkMarkerImageSrc = 'https://raw.githubusercontent.com/summ7569/summ7569.github.io/master/category3.png';

    var coffeeMarkers = [],
        storeMarkers = [],
        carparkMarkers = [];

    var category = "all";

    // 기존 마커들을 초기화합니다.
    initializeMarkers();

    function initializeMarkers() {
        coffeePositions.forEach((position, index) => {
            var marker = createMarker(position, coffeeInfo[index], coffeeMarkerImageSrc);
            coffeeMarkers.push(marker);
        });

        storePositions.forEach((position, index) => {
            var marker = createMarker(position, storeInfo[index], storeMarkerImageSrc);
            storeMarkers.push(marker);
        });

        carparkPositions.forEach((position, index) => {
            var marker = createMarker(position, carparkInfo[index], carparkMarkerImageSrc);
            carparkMarkers.push(marker);
        });

        // 처음에 모든 마커를 표시합니다.
        setMarkers(map, coffeeMarkers);
        setMarkers(map, storeMarkers);
        setMarkers(map, carparkMarkers);
    }

    function createMarker(position, info, imageSrc) {
        var markerImage = new kakao.maps.MarkerImage(imageSrc, new kakao.maps.Size(22, 26), {
            offset: new kakao.maps.Point(11, 26)
        });

        var marker = new kakao.maps.Marker({
            position: position,
            image: markerImage
        });

        var overlayContent = `
            <div class="customoverlay">
                <div class="overlaybody">
                    <div class="overlayheader">
                        <span class="title">${info.주소}</span>
                        <span class="close" onclick="closeOverlay()">X</span>
                    </div>
                    <div class="overlayinfo">
                        <div><strong>관리번호:</strong> ${info.관리번호}</div>
                        <div><strong>주소:</strong> ${info.주소}</div>
                        <div><strong>회전형:</strong> ${info.회전형}</div>
                        <div><strong>고정형:</strong> ${info.고정형}</div>
                        <div><strong>상세설명:</strong> ${info.상세설명}</div>
                        <div><img src="${info.이미지}" alt="${info.주소} 이미지" class="overlayimage"></div>
                    </div>
                </div>
                <div class="arrow"></div>
            </div>
        `;

        var overlay = new kakao.maps.CustomOverlay({
            content: overlayContent,
            map: map,
            position: marker.getPosition()
        });

        kakao.maps.event.addListener(marker, 'click', function() {
            closeOverlay();
            overlay.setMap(map);
        });

        return marker;
    }

    function setMarkers(map, markers) {
        markers.forEach(marker => marker.setMap(map));
    }

    function changeMarker(type) {
        category = type;

        // 모든 커스텀 오버레이를 닫습니다.
        closeOverlay();

        setMarkers(null, coffeeMarkers);
        setMarkers(null, storeMarkers);
        setMarkers(null, carparkMarkers);

        switch (type) {
            case 'coffee':
                setMarkers(map, coffeeMarkers);
                break;
            case 'store':
                setMarkers(map, storeMarkers);
                break;
            case 'carpark':
                setMarkers(map, carparkMarkers);
                break;
            case 'all':
                setMarkers(map, coffeeMarkers);
                setMarkers(map, storeMarkers);
                setMarkers(map, carparkMarkers);
                break;
        }
    }

    function closeOverlay() {
        coffeeMarkers.forEach(marker => {
            if (marker.overlay) {
                marker.overlay.setMap(null);
            }
        });
        storeMarkers.forEach(marker => {
            if (marker.overlay) {
                marker.overlay.setMap(null);
            }
        });
        carparkMarkers.forEach(marker => {
            if (marker.overlay) {
                marker.overlay.setMap(null);
            }
        });
    }

    function moveToCoordinates() {
        var latitude = parseFloat(document.getElementById("latitude").value);
        var longitude = parseFloat(document.getElementById("longitude").value);

        var position = new kakao.maps.LatLng(latitude, longitude);

        map.setCenter(position);
    }

    // 새로운 마커 추가 함수
    function addMarker() {
        var latitude = parseFloat(document.getElementById("latitude").value);
        var longitude = parseFloat(document.getElementById("longitude").value);
        var category = document.getElementById("category").value;
        var info = {
            관리번호: document.getElementById("관리번호").value,
            주소: document.getElementById("주소").value,
            회전형: document.getElementById("회전형").checked ? "O" : "X",
            고정형: document.getElementById("고정형").checked ? "O" : "X",
            상세설명: document.getElementById("상세설명").value,
            이미지: document.getElementById("이미지").value
        };

        var position = new kakao.maps.LatLng(latitude, longitude);
        var imageSrc = "";

        switch (category) {
            case 'coffee':
                imageSrc = coffeeMarkerImageSrc;
                break;
            case 'store':
                imageSrc = storeMarkerImageSrc;
                break;
            case 'carpark':
                imageSrc = carparkMarkerImageSrc;
                break;
        }

        var marker = createMarker(position, info, imageSrc);

        switch (category) {
            case 'coffee':
                coffeeMarkers.push(marker);
                if (category === 'coffee' || category === 'all') {
                    setMarkers(map, coffeeMarkers);
                }
                break;
            case 'store':
                storeMarkers.push(marker);
                if (category === 'store' || category === 'all') {
                    setMarkers(map, storeMarkers);
                }
                break;
            case 'carpark':
                carparkMarkers.push(marker);
                if (category === 'carpark' || category === 'all') {
                    setMarkers(map, carparkMarkers);
                }
                break;
        }

        map.setCenter(position);  // 추가된 마커의 위치로 지도를 이동
        saveMarkersToLocalStorage();
    }

    // 로컬 스토리지에 마커 저장
    function saveMarkersToLocalStorage() {
        var markersData = {
            coffee: coffeeMarkers.map(marker => ({
                position: marker.getPosition(),
                content: marker.overlay ? marker.overlay.getContent() : ""
            })),
            store: storeMarkers.map(marker => ({
                position: marker.getPosition(),
                content: marker.overlay ? marker.overlay.getContent() : ""
            })),
            carpark: carparkMarkers.map(marker => ({
                position: marker.getPosition(),
                content: marker.overlay ? marker.overlay.getContent() : ""
            }))
        };

        localStorage.setItem('markersData', JSON.stringify(markersData));
    }

    // 로컬 스토리지에서 마커 불러오기
    function loadMarkersFromLocalStorage() {
        var markersData = JSON.parse(localStorage.getItem('markersData'));

        if (markersData) {
            markersData.coffee.forEach(data => {
                var position = new kakao.maps.LatLng(data.position.Ma, data.position.La);
                var marker = createMarker(position, coffeeInfo.find(info => info.주소 === data.content.split('<strong>주소:</strong> ')[1].split('</div>')[0]), coffeeMarkerImageSrc);
                coffeeMarkers.push(marker);
            });

            markersData.store.forEach(data => {
                var position = new kakao.maps.LatLng(data.position.Ma, data.position.La);
                var marker = createMarker(position, storeInfo.find(info => info.주소 === data.content.split('<strong>주소:</strong> ')[1].split('</div>')[0]), storeMarkerImageSrc);
                storeMarkers.push(marker);
            });

            markersData.carpark.forEach(data => {
                var position = new kakao.maps.LatLng(data.position.Ma, data.position.La);
                var marker = createMarker(position, carparkInfo.find(info => info.주소 === data.content.split('<strong>주소:</strong> ')[1].split('</div>')[0]), carparkMarkerImageSrc);
                carparkMarkers.push(marker);
            });

            changeMarker(category);
        }
    }

    // 로컬 스토리지에서 마커 초기화
    function clearMarkers() {
        localStorage.removeItem('markersData');

        setMarkers(null, coffeeMarkers);
        setMarkers(null, storeMarkers);
        setMarkers(null, carparkMarkers);

        coffeeMarkers = [];
        storeMarkers = [];
        carparkMarkers = [];
    }

    // 페이지 로드 시 로컬 스토리지에서 마커를 불러옵니다.
    window.onload = loadMarkersFromLocalStorage;

    // UI 숨기기/보이기 기능 추가
    var uiVisible = true;

    function toggleUI() {
        var category = document.querySelector('.category');
        var searchForm = document.getElementById('searchForm');
        var toggleButton = document.getElementById('toggleUI');

        uiVisible = !uiVisible;

        category.style.display = uiVisible ? 'block' : 'none';
        searchForm.style.display = uiVisible ? 'block' : 'none';
        toggleButton.innerText = uiVisible ? 'UI 숨기기' : 'UI 보이기';
    }
</script>
</body>
</html>
