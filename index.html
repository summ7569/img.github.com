function changeMarker(type) {
    category = type;

    // 기존에 열려있는 커스텀 오버레이를 닫습니다.
    closeOverlay();

    // 모든 인포윈도우를 닫습니다.
    closeAllInfoWindows();

    setMarkers(null, coffeeMarkers);
    setMarkers(null, storeMarkers);
    setMarkers(null, carparkMarkers);

    switch (type) {
        case 'coffee':
            setMarkers(map, coffeeMarkers);
            break;
        case 'store':
            setMarkers(map, storeMarkers);
            break;
        case 'carpark':
            setMarkers(map, carparkMarkers);
            break;
        case 'all':
            setMarkers(map, coffeeMarkers);
            setMarkers(map, storeMarkers);
            setMarkers(map, carparkMarkers);
            break;
    }
}

function displayOverlay(marker, info) {
    var overlayContent = document.getElementById('overlayContent');
    var overlayInfo = document.getElementById('overlayInfo');
    var overlayClose = document.getElementById('overlayClose');

    overlayInfo.innerHTML = `
        <div id="markerNumber">관리번호: ${info.number}</div>
        <div id="address">주소: ${info.address}</div>
        <div id="rotation">회전형: ${info.rotation}</div>
        <div id="fixed">고정형: ${info.fixed}</div>
        <div id="description">상세설명: ${info.description}</div>
        <div id="image"><img src="${info.image}" style="max-width: 100%; height: auto;"></div>
    `;

    var overlay = new kakao.maps.CustomOverlay({
        content: overlayContent,
        map: map,
        position: marker.getPosition()
    });

    // 커스텀 오버레이를 열었을 때 해당 오버레이를 저장하여 닫을 때 사용할 수 있도록 합니다.
    marker.overlay = overlay;

    overlay.setMap(map);
    overlay.setZIndex(10);

    overlayClose.onclick = function() {
        closeOverlay();
    };
}

function closeOverlay() {
    if (map && map.getOverlayMapTypeId() !== kakao.maps.MapTypeId.OVERLAY) {
        return;
    }

    coffeeMarkers.forEach(marker => {
        if (marker.overlay) {
            marker.overlay.setMap(null);
        }
    });

    storeMarkers.forEach(marker => {
        if (marker.overlay) {
            marker.overlay.setMap(null);
        }
    });

    carparkMarkers.forEach(marker => {
        if (marker.overlay) {
            marker.overlay.setMap(null);
        }
    });
}
