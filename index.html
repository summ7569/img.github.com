<!DOCTYPE HTML>
<HTML lang="kr">
<head>
    <meta charset="utf-8">
    <title>test11</title>
    <style>
        #mapwrap {
            position: relative;
            overflow: hidden;
        }

        .category, .category * {
            margin: 0;
            padding: 0;
            color: #000;
        }

        .category {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 250px;
            height: 50px;
            z-index: 10;
            border: 1px solid black;
            background-color: #fff;
            font-family: 'Malgun Gothic', '맑은 고딕', sans-serif;
            font-size: 12px;
            text-align: center;
        }

        .category .menu_selected {
            background: #FF5F4A;
            color: #fff;
        }

        .category li {
            list-style: none;
            float: left;
            width: 60px;
            height: 45px;
            padding-top: 5px;
            cursor: pointer;
        }

        .category .ico_comm {
            display: block;
            margin: 0 auto 2px;
            width: 22px;
            height: 26px;
            background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/category.png') no-repeat;
        }

        .category .ico_coffee { background-position: -10px 0; }
        .category .ico_store { background-position: -10px -36px; }
        .category .ico_carpark { background-position: -10px -72px; }
        .category .ico_all { background-position: -10px -108px; }

        #toggleUI {
            position: absolute;
            bottom: 10px;
            left: 10px;
            z-index: 20;
            padding: 5px 10px;
            background-color: #fff;
            border: 1px solid #000;
            cursor: pointer;
        }
    </style>
</head>
<body>
<div id="map" style="width: 100%; height: 100%; padding-bottom: 50%; position: relative;"></div>

<div class="category">
    <ul>
        <li onclick="changeMarker('coffee')"><span class="ico_comm ico_coffee"></span>커피숍</li>
        <li onclick="changeMarker('store')"><span class="ico_comm ico_store"></span>편의점</li>
        <li onclick="changeMarker('carpark')"><span class="ico_comm ico_carpark"></span>주차장</li>
        <li onclick="changeMarker('all')"><span class="ico_comm ico_all"></span>모두</li>
    </ul>
</div>

<div style="position: absolute; top: 70px; left: 10px; z-index: 10; background-color: white; padding: 10px; border: 1px solid black;">
    <form id="searchForm">
        <label for="latitude">위도: </label><input type="text" id="latitude" required><br>
        <label for="longitude">경도: </label><input type="text" id="longitude" required><br>
        <label for="category">카테고리: </label>
        <select id="category">
            <option value="coffee">커피숍</option>
            <option value="store">편의점</option>
            <option value="carpark">주차장</option>
        </select><br>
        <label for="info">추가 정보: </label><input type="text" id="info"><br>
        <button type="button" onclick="addMarker()">추가</button>
        <button type="button" onclick="moveToCoordinates()">위치로 이동</button>
    </form>
</div>

<div id="toggleUI" onclick="toggleUI()">UI 숨기기</div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=da010f91e59f856e4b8d54937ba756b6"></script>
<script>
    var map = new kakao.maps.Map(document.getElementById('map'), {
        center: new kakao.maps.LatLng(37.499590490909185, 127.0263723554437),
        level: 5
    });

    var positions = {
        coffee: [
            { lat: 37.499590490909185, lng: 127.0263723554437, info: "부림동 52-1" },
            { lat: 37.499427948430814, lng: 127.02794423197847, info: "부림동 110-1" },
            // ... (추가 데이터 생략)
        ],
        store: [
            { lat: 37.497535461505684, lng: 127.02948149502778, info: "중앙동 52-1" },
            { lat: 37.49671536281186, lng: 127.03020491448352, info: "과천동 110-1" },
            // ... (추가 데이터 생략)
        ],
        carpark: [
            { lat: 37.49966168796031, lng: 127.03007039430118, info: "문원동 52-1" },
            { lat: 37.499463762912974, lng: 127.0288828824399, info: "문원동산 110-1" },
            // ... (추가 데이터 생략)
        ]
    };

    var markers = { coffee: [], store: [], carpark: [] };

    function createMarker(position, info) {
        var markerImage = new kakao.maps.MarkerImage(
            'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/category.png', 
            new kakao.maps.Size(22, 26), 
            { offset: new kakao.maps.Point(10, 26), spriteOrigin: new kakao.maps.Point(10, 0), spriteSize: new kakao.maps.Size(36, 98) }
        );

        var marker = new kakao.maps.Marker({ position: position, image: markerImage });
        var infowindow = new kakao.maps.InfoWindow({ content: info, removable: true });

        kakao.maps.event.addListener(marker, 'click', function() { infowindow.open(map, marker); });

        return marker;
    }

    function setMarkers(type) {
        ['coffee', 'store', 'carpark'].forEach(function(category) {
            markers[category].forEach(marker => marker.setMap(null));
        });

        if (type === 'all') {
            ['coffee', 'store', 'carpark'].forEach(function(category) {
                markers[category].forEach(marker => marker.setMap(map));
            });
        } else {
            markers[type].forEach(marker => marker.setMap(map));
        }
    }

    function initializeMarkers() {
        ['coffee', 'store', 'carpark'].forEach(function(category) {
            positions[category].forEach(function(pos) {
                var marker = createMarker(new kakao.maps.LatLng(pos.lat, pos.lng), pos.info);
                markers[category].push(marker);
            });
        });
    }

    function addMarker() {
        var lat = parseFloat(document.getElementById("latitude").value);
        var lng = parseFloat(document.getElementById("longitude").value);
        var category = document.getElementById("category").value;
        var info = document.getElementById("info").value;

        var position = new kakao.maps.LatLng(lat, lng);
        var marker = createMarker(position, info);

        markers[category].push(marker);
        saveMarkersToLocalStorage();
        setMarkers(category);
    }

    function moveToCoordinates() {
        var lat = parseFloat(document.getElementById("latitude").value);
        var lng = parseFloat(document.getElementById("longitude").value);

        map.setCenter(new kakao.maps.LatLng(lat, lng));
    }

    function saveMarkersToLocalStorage() {
        var markersData = {};
        ['coffee', 'store', 'carpark'].forEach(function(category) {
            markersData[category] = markers[category].map(marker => ({
                position: { lat: marker.getPosition().getLat(), lng: marker.getPosition().getLng() },
                content: marker.getContent()
            }));
        });
        localStorage.setItem('markersData', JSON.stringify(markersData));
    }

    function loadMarkersFromLocalStorage() {
        var markersData = JSON.parse(localStorage.getItem('markersData'));
        if (markersData) {
            ['coffee', 'store', 'carpark'].forEach(function(category) {
                markersData[category].forEach(function(data) {
                    var marker = createMarker(new kakao.maps.LatLng(data.position.lat, data.position.lng), data.content);
                    markers[category].push(marker);
                });
            });
        }
        setMarkers('all');
    }

    function toggleUI() {
        var elements = [document.querySelector('.category'), document.getElementById('searchForm')];
        elements.forEach(el => el.style.display = el.style.display === 'none' ? 'block' : 'none');
        document.getElementById('toggleUI').innerText = elements[0].style.display === 'none' ? 'UI 보이기' : 'UI 숨기기';
    }

    function changeMarker(category) {
        setMarkers(category);
    }

    initializeMarkers();
    loadMarkersFromLocalStorage();
</script>
</body>
</HTML>
