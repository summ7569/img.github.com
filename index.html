<!DOCTYPE HTML>
<HTML lang="kr">
<head>
    <meta charset="utf-8">
    <title>tes56</title>
    <style>
        #mapwrap {
            position: relative;
            overflow: hidden;
        }

        .category,
        .category * {
            margin: 0;
            padding: 0;
            color: #000;
        }

        .category {
            position: absolute;
            overflow: hidden;
            top: 10px;
            left: 10px;
            width: 250px;
            height: 50px;
            z-index: 10;
            border: 1px solid black;
            font-family: 'Malgun Gothic', '맑은 고딕', sans-serif;
            font-size: 12px;
            text-align: center;
            background-color: #fff;
        }

        .category .menu_selected {
            background: #FF5F4A;
            color: #fff;
            border-left: 1px solid #915B2F;
            border-right: 1px solid #915B2F;
            margin: 0 -1px;
        }

        .category li {
            list-style: none;
            float: left;
            width: 60px;
            height: 45px;
            padding-top: 5px;
            cursor: pointer;
        }

        .category .ico_comm {
            display: block;
            margin: 0 auto 2px;
            width: 22px;
            height: 26px;
            background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/category.png') no-repeat;
        }

        .category .ico_coffee {
            background-position: -10px 0;
        }

        .category .ico_store {
            background-position: -10px -36px;
        }

        .category .ico_carpark {
            background-position: -10px -72px;
        }
        
        .category .ico_all {
            background-position: -10px -108px;
        }

        #printSaveButtons {
            position: absolute;
            bottom: 10px;
            left: 10px;
            z-index: 10;
        }
    </style>
</head>
<body>
<div id="map" style="width: 100%; height: 100% !important; padding-bottom: 50%; position: relative;"></div>

<!-- 지도 위에 표시될 마커 카테고리 -->
<div class="category">
    <ul>
        <li id="coffeeMenu" onclick="changeMarker('coffee')">
            <span class="ico_comm ico_coffee"></span>
            커피숍
        </li>
        <li id="storeMenu" onclick="changeMarker('store')">
            <span class="ico_comm ico_store"></span>
            편의점
        </li>
        <li id="carparkMenu" onclick="changeMarker('carpark')">
            <span class="ico_comm ico_carpark"></span>
            주차장
        </li>
        <li id="allMenu" onclick="changeMarker('all')">
            <span class="ico_comm ico_all"></span>
            모두
        </li>
    </ul>
</div>

<!-- 검색 폼 추가 -->
<div id="searchForm" style="position: absolute; top: 70px; left: 10px; z-index: 10; background-color: white; padding: 10px; border: 1px solid black;">
    <form>
        <label for="latitude">위도: </label><input type="text" id="latitude" name="latitude" required><br>
        <label for="longitude">경도: </label><input type="text" id="longitude" name="longitude" required><br>
        <label for="category">카테고리: </label>
        <select id="category" name="category">
            <option value="coffee">커피숍</option>
            <option value="store">편의점</option>
            <option value="carpark">주차장</option>
        </select><br>
        <label for="info">추가 정보: </label><input type="text" id="info" name="info"><br>
        <button type="button" onclick="addMarker()">추가</button>
    </form>
</div>

<!-- 인쇄 및 저장 버튼 추가 -->
<div id="printSaveButtons" style="position: absolute; bottom: 10px; left: 10px; z-index: 10;">
    <button onclick="printMap()">지도 인쇄</button>
    <button onclick="saveAsImage()">지도 저장</button>
</div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=da010f91e59f856e4b8d54937ba756b6"></script>
<script>
    var mapContainer = document.getElementById('map'),
        mapOption = {
            center: new kakao.maps.LatLng(37.499590490909185, 127.0263723554437),
            level: 5
        };

    var map = new kakao.maps.Map(mapContainer, mapOption);

    var coffeePositions = [
        new kakao.maps.LatLng(37.499590490909185, 127.0263723554437),
        new kakao.maps.LatLng(37.499427948430814, 127.02794423197847),
        new kakao.maps.LatLng(37.498553760499505, 127.02882598822454),
        new kakao.maps.LatLng(37.497625593121384, 127.02935713582038),
        new kakao.maps.LatLng(37.49949333223966, 127.03069144884465)
    ];

    var storePositions = [
        new kakao.maps.LatLng(37.49847318243406, 127.02819527061478),
        new kakao.maps.LatLng(37.49896292488523, 127.0274044240344),
        new kakao.maps.LatLng(37.49931270165959, 127.02596232494843)
    ];

    var carparkPositions = [
        new kakao.maps.LatLng(37.50030935262944, 127.02811382692005),
        new kakao.maps.LatLng(37.49989231601729, 127.0297105235977)
    ];

    var coffeeMarkers = [],
        storeMarkers = [],
        carparkMarkers = [];

    var coffeeInfo = [
        '스타벅스',
        '이디야 커피',
        '투썸플레이스',
        '카페베네',
        '커피빈'
    ];

    var storeInfo = [
        'GS25',
        'CU',
        '세븐일레븐'
    ];

    var carparkInfo = [
        '주차장 A',
        '주차장 B'
    ];

    var markerImageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png',
        imageSize = new kakao.maps.Size(24, 35),
        coffeeImageOptions = {
            spriteOrigin: new kakao.maps.Point(10, 0),  // 커피숍 아이콘 위치
            spriteSize: new kakao.maps.Size(36, 98)
        },
        storeImageOptions = {
            spriteOrigin: new kakao.maps.Point(10, 36),  // 편의점 아이콘 위치
            spriteSize: new kakao.maps.Size(36, 98)
        },
        carparkImageOptions = {
            spriteOrigin: new kakao.maps.Point(10, 72),  // 주차장 아이콘 위치
            spriteSize: new kakao.maps.Size(36, 98)
        };

    function createMarkerImage(src, size, options) {
        var markerImage = new kakao.maps.MarkerImage(src, size, options);
        return markerImage;
    }

    function createMarker(position, image) {
        var marker = new kakao.maps.Marker({
            position: position,
            image: image
        });
        return marker;
    }

    function createCoffeeMarkers() {
        for (var i = 0; i < coffeePositions.length; i++) {
            var markerImage = createMarkerImage(markerImageSrc, imageSize, coffeeImageOptions),
                marker = createMarker(coffeePositions[i], markerImage);

            coffeeMarkers.push(marker);

            var infowindow = new kakao.maps.InfoWindow({
                content: '<div style="padding:5px;">' + coffeeInfo[i] + '</div>',
                removable: true
            });

            kakao.maps.event.addListener(marker, 'click', makeClickListener(map, marker, infowindow));

            marker.setMap(map);
        }
    }

    function createStoreMarkers() {
        for (var i = 0; i < storePositions.length; i++) {
            var markerImage = createMarkerImage(markerImageSrc, imageSize, storeImageOptions),
                marker = createMarker(storePositions[i], markerImage);

            storeMarkers.push(marker);

            var infowindow = new kakao.maps.InfoWindow({
                content: '<div style="padding:5px;">' + storeInfo[i] + '</div>',
                removable: true
            });

            kakao.maps.event.addListener(marker, 'click', makeClickListener(map, marker, infowindow));

            marker.setMap(map);
        }
    }

    function createCarparkMarkers() {
        for (var i = 0; i < carparkPositions.length; i++) {
            var markerImage = createMarkerImage(markerImageSrc, imageSize, carparkImageOptions),
                marker = createMarker(carparkPositions[i], markerImage);

            carparkMarkers.push(marker);

            var infowindow = new kakao.maps.InfoWindow({
                content: '<div style="padding:5px;">' + carparkInfo[i] + '</div>',
                removable: true
            });

            kakao.maps.event.addListener(marker, 'click', makeClickListener(map, marker, infowindow));

            marker.setMap(map);
        }
    }

    function makeClickListener(map, marker, infowindow) {
        return function () {
            infowindow.open(map, marker);
        };
    }

    function setMarkers(type) {
        if (type === 'coffee') {
            setCoffeeMarkers();
        } else if (type === 'store') {
            setStoreMarkers();
        } else if (type === 'carpark') {
            setCarparkMarkers();
        } else if (type === 'all') {
            setAllMarkers();
        }
    }

    function setCoffeeMarkers() {
        closeAllInfowindows();
        setMapOnAll(null);
        coffeeMarkers.forEach(function (marker) {
            marker.setMap(map);
        });
    }

    function setStoreMarkers() {
        closeAllInfowindows();
        setMapOnAll(null);
        storeMarkers.forEach(function (marker) {
            marker.setMap(map);
        });
    }

    function setCarparkMarkers() {
        closeAllInfowindows();
        setMapOnAll(null);
        carparkMarkers.forEach(function (marker) {
            marker.setMap(map);
        });
    }

    function setAllMarkers() {
        closeAllInfowindows();
        setMapOnAll(map);
    }

    function setMapOnAll(map) {
        coffeeMarkers.forEach(function (marker) {
            marker.setMap(map);
        });
        storeMarkers.forEach(function (marker) {
            marker.setMap(map);
        });
        carparkMarkers.forEach(function (marker) {
            marker.setMap(map);
        });
    }

    function closeAllInfowindows() {
        coffeeInfowindows.forEach(function (infowindow) {
            infowindow.close();
        });
        storeInfowindows.forEach(function (infowindow) {
            infowindow.close();
        });
        carparkInfowindows.forEach(function (infowindow) {
            infowindow.close();
        });
    }

    function changeMarker(type) {
        setMarkers(type);
    }

    function addMarker() {
        var lat = parseFloat(document.getElementById('latitude').value);
        var lng = parseFloat(document.getElementById('longitude').value);
        var category = document.getElementById('category').value;
        var info = document.getElementById('info').value;

        if (isNaN(lat) || isNaN(lng)) {
            alert('올바른 위도와 경도를 입력하세요.');
            return;
        }

        var position = new kakao.maps.LatLng(lat, lng);
        var markerImage, marker, infowindow;

        if (category === 'coffee') {
            markerImage = createMarkerImage(markerImageSrc, imageSize, coffeeImageOptions);
            marker = createMarker(position, markerImage);
            coffeeMarkers.push(marker);
            infowindow = new kakao.maps.InfoWindow({
                content: '<div style="padding:5px;">' + (info ? info : '새로운 커피숍') + '</div>',
                removable: true
            });
        } else if (category === 'store') {
            markerImage = createMarkerImage(markerImageSrc, imageSize, storeImageOptions);
            marker = createMarker(position, markerImage);
            storeMarkers.push(marker);
            infowindow = new kakao.maps.InfoWindow({
                content: '<div style="padding:5px;">' + (info ? info : '새로운 편의점') + '</div>',
                removable: true
            });
        } else if (category === 'carpark') {
            markerImage = createMarkerImage(markerImageSrc, imageSize, carparkImageOptions);
            marker = createMarker(position, markerImage);
            carparkMarkers.push(marker);
            infowindow = new kakao.maps.InfoWindow({
                content: '<div style="padding:5px;">' + (info ? info : '새로운 주차장') + '</div>',
                removable: true
            });
        }

        kakao.maps.event.addListener(marker, 'click', makeClickListener(map, marker, infowindow));
        marker.setMap(map);
    }

    // 초기화할 때는 모든 마커를 보여줍니다
    createCoffeeMarkers();
    createStoreMarkers();
    createCarparkMarkers();
    setAllMarkers();
    
    function printMap() {
        var mapElement = document.getElementById('map');
        var printWindow = window.open('', '_blank');
        printWindow.document.open();
        printWindow.document.write('<html><head><title>Print Map</title></head><body>');
        printWindow.document.write('<img src="' + mapElement.toDataURL() + '">');
        printWindow.document.write('</body></html>');
        printWindow.document.close();
        printWindow.print();
    }

    function saveAsImage() {
        var mapElement = document.getElementById('map');
        var image = new Image();
        image.src = mapElement.toDataURL();
        var link = document.createElement('a');
        link.href = image.src;
        link.download = 'map.png';
        link.click();
    }

    function toggleUI() {
        var categoryUI = document.querySelector('.category');
        var searchForm = document.getElementById('searchForm');

        if (categoryUI.style.display === 'none') {
            categoryUI.style.display = 'block';
            searchForm.style.display = 'block';
        } else {
            categoryUI.style.display = 'none';
            searchForm.style.display = 'none';
        }
    }
</script>
</body>
</html>
