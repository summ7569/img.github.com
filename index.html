<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kakao8</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%; /* 높이를 100%로 변경 */
        }
        #categoryButtons {
            margin-top: 10px;
        }
        button {
            margin: 5px;
            padding: 5px 10px;
            cursor: pointer;
        }
        .infoWindow {
            padding: 10px;
            font-size: 14px;
            font-weight: bold;
        }
        .customOverlay {
            width: 250px; /* 가로 크기를 적절히 조정 */
            padding: 10px;
            background-color: #fff;
            border: 1px solid #ccc;
            text-align: left;
        }
        .title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .desc {
            margin-top: 5px;
        }
        .desc-content {
            display: flex; /* 내용을 가로로 배치 */
            align-items: center;
        }
        .desc-content img {
            margin-right: 10px; /* 이미지와 텍스트 사이 여백 조정 */
        }
        .closeBtn {
            position: absolute;
            top: 5px;
            right: 5px;
            cursor: pointer;
            font-size: 14px;
            color: #555;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="categoryButtons"></div>

    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=da010f91e59f856e4b8d54937ba756b6&libraries=services"></script>
    <script type="text/javascript" src="http://dapi.kakao.com/v2/maps/sdk.js?autoload=false"></script>
<script type="text/javascript">
kakao.maps.load(function() {
    // v3가 모두 로드된 후, 이 콜백 함수가 실행됩니다.
    var map = new kakao.maps.Map(node, options);
});
</script>

    <script>
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: new kakao.maps.LatLng(37.4295040000, 126.9883220000),
            level: 5
        };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        var categories = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K'];

        var categoryData = {
            'A': { name: '갈현동', lat: 37.639, lng: 126.834 },
            'B': { name: '과천동', lat: 37.429, lng: 126.996 },
            'C': { name: '문원동', lat: 37.428, lng: 127.008 },
            'D': { name: '별양동', lat: 37.426, lng: 126.994 },
            'E': { name: '부림동', lat: 37.429, lng: 127.000 },
            'F': { name: '주암동', lat: 37.430, lng: 127.013 },
            'G': { name: '중앙동', lat: 37.433, lng: 126.999 },
            'H': { name: '기타', lat: 37.440, lng: 127.002 },
            'I': { name: '회전형', filter: 'rotation', minCount: 1, imageUrl: "https://via.placeholder.com/120" },
            'J': { name: '고정형', filter: 'fixed', minCount: 1, imageUrl: "https://via.placeholder.com/120" },
            'K': { name: '전부', includeAll: true }
        };

        var Apositions = [
            { category: '갈현동', lat: 37.639, lng: 126.834 }
        ];
        var AInfo = [
            {
                number: "HP-111",
                address: "갈현동",
                rotation: 1,
                fixed: 5,
                description: "갈현동 어린이집 앞",
                image: "https://via.placeholder.com/150"
            }
        ];

        var Bpositions = [
            { category: '과천동', lat: 37.429, lng: 126.996 }
        ];
        var BInfo = [
            {
                number: "HP-112",
                address: "과천동",
                rotation: 2,
                fixed: 3,
                description: "과천동 어린이집 앞",
                image: "https://via.placeholder.com/150"
            }
        ];

        var Cpositions = [
            { category: '문원동', lat: 37.428, lng: 127.008 }
        ];
        var CInfo = [
            {
                number: "HP-113",
                address: "문원동",
                rotation: 3,
                fixed: 2,
                description: "문원동 어린이집 앞",
                image: "https://via.placeholder.com/150"
            }
        ];

        var Dpositions = [
            { category: '별양동', lat: 37.426, lng: 126.994 }
        ];
        var DInfo = [
            {
                number: "HP-114",
                address: "별양동",
                rotation: 0,
                fixed: 4,
                description: "별양동 어린이집 앞",
                image: "https://via.placeholder.com/150"
            }
        ];

        var Epositions = [
            { category: '부림동', lat: 37.429, lng: 127.000 }
        ];
        var EInfo = [
            {
                number: "HP-115",
                address: "부림동",
                rotation: 1,
                fixed: 3,
                description: "부림동 어린이집 앞",
                image: "https://via.placeholder.com/150"
            }
        ];

        var Fpositions = [
            { category: '주암동', lat: 37.430, lng: 127.013 }
        ];
        var FInfo = [
            {
                number: "HP-116",
                address: "주암동",
                rotation: 0,
                fixed: 2,
                description: "주암동 어린이집 앞",
                image: "https://via.placeholder.com/150"
            }
        ];

        var Gpositions = [
            { category: '중앙동', lat: 37.433, lng: 126.999 }
        ];
        var GInfo = [
            {
                number: "HP-117",
                address: "중앙동",
                rotation: 2,
                fixed: 1,
                description: "중앙동 어린이집 앞",
                image: "https://via.placeholder.com/150"
            }
        ];

        var Hpositions = [
            { category: '기타', lat: 37.440, lng: 127.002 }
        ];
        var HInfo = [
            {
                number: "HP-118",
                address: "기타",
                rotation: 1,
                fixed: 0,
                description: "기타 어린이집 앞",
                image: "https://via.placeholder.com/150"
            }
        ];

        var positions = Apositions.concat(Bpositions, Cpositions, Dpositions, Epositions, Fpositions, Gpositions, Hpositions);

        var info = AInfo.concat(BInfo, CInfo, DInfo, EInfo, FInfo, GInfo, HInfo);

        var markers = [];
        var currentOverlay = null;
        var currentInfowindow = null; // 현재 열린 인포윈도우를 저장할 변수 추가

        function createMarkersAndOverlays(category) {
            closeCustomOverlay(); // 현재 열려 있는 커스텀 오버레이 닫기
            markers.forEach(function(marker) {
                marker.setMap(null);
            });
            markers = [];

            positions.forEach(function(position, catIndex) {
                if (category === 'K' || position.category === category) {
                    var markerPosition = new kakao.maps.LatLng(position.lat, position.lng);

                    var marker = new kakao.maps.Marker({
                        position: markerPosition
                    });
                    markers.push(marker);

                    kakao.maps.event.addListener(marker, 'click', function() {
                        showInfoWindow(marker, catIndex);
                        showCustomOverlay(position, catIndex);
                    });

                    marker.setMap(map);
                }
            });
        }

        function closeCustomOverlay() {
            if (currentOverlay) {
                currentOverlay.setMap(null);
                currentOverlay = null;
            }
        }

        function showInfoWindow(marker, catIndex) {
            // 기존에 열려 있던 인포윈도우 닫기
            if (currentInfowindow) {
                currentInfowindow.close();
            }

            // 새로운 인포윈도우 열기
            currentInfowindow = new kakao.maps.InfoWindow({
                content: '<div class="infoWindow">' + info[catIndex].number + '</div>',
                removable: true
            });
            currentInfowindow.open(map, marker);
        }

        function showCustomOverlay(position, catIndex) {
            var overlayContent =
                '<div class="customOverlay">' +
                '    <span class="closeBtn" onclick="closeCustomOverlay()">닫기</span>' +
                '    <div class="title">' + position.category + '</div>' +
                '    <div class="desc">' +
                '        <div class="desc-content">' +
                '            <img src="' + info[catIndex].image + '" width="50" height="50">' +
                '            <div>' +
                '                <p>관리번호 : ' + info[catIndex].number + '</p>' +
                '                <p>주소 : ' + info[catIndex].address + '</p>' +
                '                <p>회전형 : ' + info[catIndex].rotation + '</p>' +
                '                <p>고정형 : ' + info[catIndex].fixed + '</p>' +
                '                <p>상세설명 : ' + info[catIndex].description + '</p>' +
                '            </div>' +
                '        </div>' +
                '    </div>' +
                '</div>';

            currentOverlay = new kakao.maps.CustomOverlay({
                content: overlayContent,
                map: map,
                position: new kakao.maps.LatLng(position.lat, position.lng),
                yAnchor: 1
            });
        }

        var categoryButtons = document.getElementById('categoryButtons');

        categories.forEach(function(category) {
            var button = document.createElement('button');
            button.textContent = category;
            button.addEventListener('click', function() {
                createMarkersAndOverlays(category);
            });
            categoryButtons.appendChild(button);
        });

        createMarkersAndOverlays('K'); // 초기에 모든 마커와 오버레이를 표시합니다.
    </script>
</body>
</html>
