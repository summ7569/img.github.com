<!DOCTYPE HTML>
<HTML lang="kr">
<head>
    <meta charset="utf-8">
    <title>tes99</title>
    <style>
        /* 공통 스타일 */
        #mapwrap {
            position: relative;
            overflow: hidden;
        }

        .category,
        .category * {
            margin: 0;
            padding: 0;
            color: #000;
        }

        .category {
            position: absolute;
            overflow: hidden;
            top: 10px;
            left: 10px;
            width: 250px;
            height: 50px;
            z-index: 10;
            border: 1px solid black;
            font-family: 'Malgun Gothic', '맑은 고딕', sans-serif;
            font-size: 12px;
            text-align: center;
            background-color: #fff;
        }

        .category .menu_selected {
            background: #FF5F4A;
            color: #fff;
            border-left: 1px solid #915B2F;
            border-right: 1px solid #915B2F;
            margin: 0 -1px;
        }

        .category li {
            list-style: none;
            float: left;
            width: 60px;
            height: 45px;
            padding-top: 5px;
            cursor: pointer;
        }

        .category .ico_comm {
            display: block;
            margin: 0 auto 2px;
            width: 22px;
            height: 26px;
            background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/category.png') no-repeat;
        }

        .category .ico_coffee {
            background-position: -10px 0;
        }

        .category .ico_store {
            background-position: -10px -36px;
        }

        .category .ico_carpark {
            background-position: -10px -72px;
        }

        .category .ico_all {
            background-position: -10px -108px;
        }

        /* 추가된 스타일 */
        #toggleUI {
            position: absolute;
            bottom: 10px;
            left: 10px;
            z-index: 20;
            padding: 5px 10px;
            background-color: #fff;
            border: 1px solid #000;
            cursor: pointer;
        }

        /* 스타일 end */

        /* 여기서부터 스크립트 */
        #map {
            width: 100%;
            height: 100% !important;
            padding-bottom: 50%;
            position: relative;
        }

        /* 공통 스크립트 */
        /* 지도 관련 */
        var mapContainer = document.getElementById('map'),
            mapOption = {
                center: new kakao.maps.LatLng(37.499590490909185, 127.0263723554437),
                level: 5
            };

        var map = new kakao.maps.Map(mapContainer, mapOption);

        var coffeePositions = [
            new kakao.maps.LatLng(37.499590490909185, 127.0263723554437),
            new kakao.maps.LatLng(37.499427948430814, 127.02794423197847),
            new kakao.maps.LatLng(37.498553760499505, 127.02882598822454),
            new kakao.maps.LatLng(37.497625593121384, 127.02935713582038),
            new kakao.maps.LatLng(37.49646391248451, 127.02675574250912),
            new kakao.maps.LatLng(37.49629291770947, 127.02587362608637),
            new kakao.maps.LatLng(37.49754540521486, 127.02546694890695)
        ];

        var coffeeInfo = [
            "부림동 52-1",
            "부림동 110-1",
            "부림동 140-1",
            "부림동 120-1",
            "부림동 122-221",
            "부림동 540-1",
            "부림동 1340-1"
        ];

        var storePositions = [
            new kakao.maps.LatLng(37.497535461505684, 127.02948149502778),
            new kakao.maps.LatLng(37.49671536281186, 127.03020491448352),
            new kakao.maps.LatLng(37.496201943633714, 127.02959405469642),
            new kakao.maps.LatLng(37.49640072567703, 127.02726459882308),
            new kakao.maps.LatLng(37.49640098874988, 127.02609983175294),
            new kakao.maps.LatLng(37.49932849491523, 127.02935780247945),
            new kakao.maps.LatLng(37.49996818951873, 127.02943721562295)
        ];

        var storeInfo = [
            "중앙동 52-1",
            "과천동 110-1",
            "중앙동 140-1",
            "과천동 120-1",
            "과천동 122-221",
            "과천동 540-1",
            "과천동 1340-1"
        ];

        var carparkPositions = [
            new kakao.maps.LatLng(37.49966168796031, 127.03007039430118),
            new kakao.maps.LatLng(37.499463762912974, 127.0288828824399),
            new kakao.maps.LatLng(37.49896834100913, 127.02833986892401),
            new kakao.maps.LatLng(37.49893267508434, 127.02673400572665),
            new kakao.maps.LatLng(37.49872543597439, 127.02676785815386),
            new kakao.maps.LatLng(37.49813096097184, 127.02591949495914),
            new kakao.maps.LatLng(37.497680616783086, 127.02518427952202)
        ];

        var carparkInfo = [
            "문원동 52-1",
            "문원동산 110-1",
            "혜화역 140-1",
            "과천Ic 120-1",
            "부천 122-221",
            "부산 540-1",
            "우편번호 1340-1"
        ];

        var markers = []; // 모든 마커를 관리할 배열
        var infowindows = []; // 모든 인포윈도우를 관리할 배열
        var storedMarkers = JSON.parse(localStorage.getItem('markers')) || []; // LocalStorage에서 저장된 마커 데이터 가져오기

        // 저장된 마커들을 지도에 표시하는 함수
        function displayStoredMarkers() {
            storedMarkers.forEach(function(markerData) {
                var position = new kakao.maps.LatLng(markerData.lat, markerData.lng);
                var category = markerData.category;
                var info = markerData.info;

                var imageSrc = getCategoryIcon(category);
                var imageSize = new kakao.maps.Size(30, 30);
                var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);

                var marker = new kakao.maps.Marker({
                    position: position,
                    image: markerImage
                });

                var infowindow = new kakao.maps.InfoWindow({
                    content: '<div style="padding:5px;font-size:12px;">' + info + '</div>'
                });

                kakao.maps.event.addListener(marker, 'click', function() {
                    infowindow.open(map, marker);
                });

                markers.push(marker);
                infowindows.push(infowindow);

                marker.setMap(map);
            });
        }

        // 저장된 데이터 삭제 버튼 기능
        function clearLocalStorage() {
            localStorage.removeItem('markers');
            location.reload(); // 페이지 새로고침
        }

        // 현재 화면의 UI 숨기기/보이기 버튼 기능
        function toggleUI() {
            var category = document.querySelector('.category');
            var searchForm = document.querySelector('#searchForm');

            if (category.style.display === 'none') {
                category.style.display = 'block';
                searchForm.style.display = 'block';
                document.getElementById('toggleUI').textContent = 'UI 숨기기';
            } else {
                category.style.display = 'none';
                searchForm.style.display = 'none';
                document.getElementById('toggleUI').textContent = 'UI 보이기';
            }
        }

        // 카테고리에 따라 마커 아이콘을 반환하는 함수
        function getCategoryIcon(category) {
            var icons = {
                coffee: 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/category_coffee.png',
                store: 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/category_store.png',
                carpark: 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/category_parking.png'
            };
            return icons[category] || '';
        }

        // 검색 폼에서 입력된 데이터로 새로운 마커를 추가하는 함수
        function addMarker() {
            var latitude = document.getElementById('latitude').value;
            var longitude = document.getElementById('longitude').value;
            var category = document.getElementById('categorySelect').value;
            var info = document.getElementById('info').value;

            var position = new kakao.maps.LatLng(latitude, longitude);
            var imageSrc = getCategoryIcon(category);
            var imageSize = new kakao.maps.Size(30, 30);
            var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);

            var marker = new kakao.maps.Marker({
                position: position,
                image: markerImage
            });

            var infowindow = new kakao.maps.InfoWindow({
                content: '<div style="padding:5px;font-size:12px;">' + info + '</div>'
            });

            kakao.maps.event.addListener(marker, 'click', function() {
                infowindow.open(map, marker);
            });

            markers.push(marker);
            infowindows.push(infowindow);

            marker.setMap(map);

            // LocalStorage에 마커 데이터 저장
            storedMarkers.push({
                lat: latitude,
                lng: longitude,
                category: category,
                info: info
            });
            localStorage.setItem('markers', JSON.stringify(storedMarkers));

            document.getElementById('latitude').value = '';
            document.getElementById('longitude').value = '';
            document.getElementById('info').value = '';
        }

        // 카테고리에 따라 마커를 보여주거나 숨기는 함수
        function changeMarker(category) {
            markers.forEach(function(marker) {
                marker.setMap(null); // 모든 마커를 지도에서 제거
            });

            markers = []; // 배열 비우기

            if (category === 'all') {
                displayStoredMarkers();
            } else {
                var positions;
                var info;

                switch (category) {
                    case 'coffee':
                        positions = coffeePositions;
                        info = coffeeInfo;
                        break;
                    case 'store':
                        positions = storePositions;
                        info = storeInfo;
                        break;
                    case 'carpark':
                        positions = carparkPositions;
                        info = carparkInfo;
                        break;
                    default:
                        positions = [];
                        info = [];
                        break;
                }

                positions.forEach(function(position, index) {
                    var marker = new kakao.maps.Marker({
                        position: position,
                        image: new kakao.maps.MarkerImage(getCategoryIcon(category), new kakao.maps.Size(30, 30)),
                        map: map
                    });

                    var infowindow = new kakao.maps.InfoWindow({
                        content: '<div style="padding:5px;font-size:12px;">' + info[index] + '</div>'
                    });

                    kakao.maps.event.addListener(marker, 'click', function() {
                        infowindow.open(map, marker);
                    });

                    markers.push(marker);
                    infowindows.push(infowindow);
                });
            }
        }

        // 초기화 함수
        function initMap() {
            displayStoredMarkers();
        }

        initMap();
    </script>
</head>

<body>
  <div id="map" style="width: 100%; height: 100%; position: relative;"></div>
  
  <!-- 지도 위에 표시될 마커 카테고리 -->
  <div class="category">
      <ul>
          <li id="coffeeMenu" onclick="changeMarker('coffee')">
              <span class="ico_comm ico_coffee"></span>
              커피숍
          </li>
          <li id="storeMenu" onclick="changeMarker('store')">
              <span class="ico_comm ico_store"></span>
              편의점
          </li>
          <li id="carparkMenu" onclick="changeMarker('carpark')">
              <span class="ico_comm ico_carpark"></span>
              주차장
          </li>
          <li id="allMenu" onclick="changeMarker('all')">
              <span class="ico_comm ico_all"></span>
              모두
          </li>
      </ul>
  </div>

  <!-- 검색 폼 추가 -->
  <div class="search-form">
      <form id="searchForm">
          <label for="latitude">위도: </label><input type="text" id="latitude" name="latitude" required><br>
          <label for="longitude">경도: </label><input type="text" id="longitude" name="longitude" required><br>
          <label for="category">카테고리: </label>
          <select id="categorySelect" name="category">
              <option value="coffee">커피숍</option>
              <option value="store">편의점</option>
              <option value="carpark">주차장</option>
          </select><br>
          <label for="info">추가 정보: </label><input type="text" id="info" name="info"><br>
          <button type="button" onclick="addMarker()">추가</button>
          <button type="button" onclick="moveToCoordinates()">위치로 이동</button>
      </form>
  </div>

  <!-- UI 숨기기/보이기 버튼 -->
  <div id="toggleUI" onclick="toggleUI()">UI 숨기기</div>

  <!-- 데이터 삭제 버튼 -->
  <div id="clearData" onclick="clearLocalStorage()">저장된 데이터 삭제</div>
</body>

</html>
