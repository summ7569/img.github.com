<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kakao Maps Example</title>
<style>
    #mapwrap {
        position: relative;
        overflow: hidden;
        width: 100%;
        height: 600px; /* 지도 높이 설정 */
    }

    .category,
    .category * {
        margin: 0;
        padding: 0;
        color: #000;
    }

    .category {
        position: absolute;
        overflow: hidden;
        top: 10px;
        left: 10px;
        width: 250px;
        height: 50px;
        z-index: 10;
        border: 1px solid black;
        font-family: 'Malgun Gothic', '맑은 고딕', sans-serif;
        font-size: 12px;
        text-align: center;
        background-color: #fff;
    }

    .category .menu_selected {
        background: #FF5F4A;
        color: #fff;
        border-left: 1px solid #915B2F;
        border-right: 1px solid #915B2F;
        margin: 0 -1px;
    }

    .category li {
        list-style: none;
        float: left;
        width: 60px;
        height: 45px;
        padding-top: 5px;
        cursor: pointer;
    }

    .category .ico_comm {
        display: block;
        margin: 0 auto 2px;
        width: 22px;
        height: 26px;
        background: url('https://github.com/summ7569/summ7569.github.io/blob/master/category.png?raw=true') no-repeat;
    }

    .category .ico_coffee {
        background-position: -10px 0;
    }

    .category .ico_store {
        background-position: -10px -36px;
    }

    .category .ico_carpark {
        background-position: -10px -72px;
    }

    .category .ico_all {
        background-position: -10px -108px;
    }

    /* 추가된 스타일 */
    #toggleUI {
        position: absolute;
        bottom: 10px;
        left: 10px;
        z-index: 20;
        padding: 5px 10px;
        background-color: #fff;
        border: 1px solid #000;
        cursor: pointer;
    }

    /* 커스텀 오버레이 스타일 */
    .customOverlay {
        position: absolute;
        background-color: #fff;
        border: 1px solid #ccc;
        box-shadow: 3px 3px 5px rgba(0,0,0,0.3);
        padding: 10px;
        min-width: 200px;
        font-family: 'Malgun Gothic', '맑은 고딕', sans-serif;
        font-size: 12px;
        z-index: 100;
        display: none; /* 기본적으로 숨겨진 상태 */
    }

    .customOverlay h3 {
        font-size: 14px;
        margin-bottom: 5px;
    }

    .customOverlay p {
        margin-bottom: 8px;
    }

    .customOverlay button.close {
        background-color: #ccc;
        color: #000;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        font-size: 12px;
    }

    .customOverlay button.close:hover {
        background-color: #aaa;
    }
</style>
</head>
<body>

<div id="mapwrap">
    <div id="map" style="width:100%;height:100%;"></div>
    <div class="category">
        <ul>
            <li class="menu_selected">커피</li>
            <li class="ico_comm ico_coffee"></li>
            <li class="ico_comm ico_store"></li>
            <li class="ico_comm ico_carpark"></li>
            <li class="ico_comm ico_all">전체</li>
        </ul>
    </div>
    <div id="toggleUI" onclick="toggleUI()">UI 숨기기</div>
</div>

<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_APP_KEY&libraries=services"></script>
<script>
    var mapContainer = document.getElementById('map');
    var mapOption = {
        center: new kakao.maps.LatLng(37.499590490909185, 127.0263723554437),
        level: 5
    };

    var map = new kakao.maps.Map(mapContainer, mapOption);

    var coffeePositions = [
        { 
            position: new kakao.maps.LatLng(37.499590490909185, 127.0263723554437),
            content: '<div class="customOverlay">' +
                     '    <h3>커피 위치 정보</h3>' +
                     '    <p>주소: 부림동 52-1</p>' +
                     '    <p>상세내용: 커피 맛집입니다.</p>' +
                     '    <button class="close" onclick="closeOverlay(' + markerList.length + ')">닫기</button>' +
                     '</div>'
        },
        {
            position: new kakao.maps.LatLng(37.499427948430814, 127.02794423197847),
            content: '<div class="customOverlay">' +
                     '    <h3>커피 위치 정보</h3>' +
                     '    <p>주소: 부림동 110-1</p>' +
                     '    <p>상세내용: 한 잔의 휴식을 찾을 수 있는 곳입니다.</p>' +
                     '    <button class="close" onclick="closeOverlay(' + markerList.length + ')">닫기</button>' +
                     '</div>'
        }
    ];

    var storePositions = [
        {
            position: new kakao.maps.LatLng(37.497535461505684, 127.02948149502778),
            content: '<div class="customOverlay">' +
                     '    <h3>가게 위치 정보</h3>' +
                     '    <p>주소: 중앙동 52-1</p>' +
                     '    <p>상세내용: 다양한 상품을 즐길 수 있는 가게입니다.</p>' +
                     '    <button class="close" onclick="closeOverlay(' + markerList.length + ')">닫기</button>' +
                     '</div>'
        }
    ];

    var carparkPositions = [
        {
            position: new kakao.maps.LatLng(37.49966168796031, 127.03007039430118),
            content: '<div class="customOverlay">' +
                     '    <h3>주차장 위치 정보</h3>' +
                     '    <p>주소: 공원동 52-1</p>' +
                     '    <p>상세내용: 중앙공원 내 물놀이터에 위치한 주차장입니다.</p>' +
                     '    <p>회전형: 1대 (비알인포텍), 고정형: 7대 (레스큐)</p>' +
                     '    <button class="close" onclick="closeOverlay(' + markerList.length + ')">닫기</button>' +
                     '</div>'
        }
    ];

    var markerImageSrc = 'https://github.com/summ7569/summ7569.github.io/blob/master/category.png?raw=true';

    var markerList = [];
    var overlayList = [];

    function displayMarkers() {
        displayMarker(coffeePositions, 'coffee', 'ico_coffee');
        displayMarker(storePositions, 'store', 'ico_store');
        displayMarker(carparkPositions, 'carpark', 'ico_carpark');
    }

    function displayMarker(locations, category, imgSrc) {
        for (var i = 0; i < locations.length; i++) {
            var imageSize = new kakao.maps.Size(22, 26),
                imgOptions = {
                    spriteSize: new kakao.maps.Size(36, 98),
                    spriteOrigin: new kakao.maps.Point(10, imgSrc === 'ico_coffee' ? 0 : imgSrc === 'ico_store' ? 36 : 72),
                    offset: new kakao.maps.Point(11, 26)
                },
                markerImage = new kakao.maps.MarkerImage(markerImageSrc, imageSize, imgOptions),
                marker = new kakao.maps.Marker({
                    position: locations[i].position,
                    image: markerImage,
                    category: category
                });

            var customOverlay = new kakao.maps.CustomOverlay({
                content: locations[i].content,
                map: map,
                position: locations[i].position,
                yAnchor: 1
            });

            kakao.maps.event.addListener(marker, 'click', function(customOverlay) {
                return function() {
                    closeAllOverlays();
                    customOverlay.setMap(map);
                };
            }(customOverlay));

            marker.setMap(map);
            markerList.push(marker);
            overlayList.push(customOverlay);
        }
    }

    function closeOverlay(index) {
        overlayList[index].setMap(null);
    }

    function closeAllOverlays() {
        for (var i = 0; i < overlayList.length; i++) {
            overlayList[i].setMap(null);
        }
    }

    function clearMarkers() {
        for (var i = 0; i < markerList.length; i++) {
            markerList[i].setMap(null);
        }
        markerList = [];
        overlayList = [];
    }

    // 초기화 함수
    function initMap() {
        displayMarkers();
        showInitialOverlays(); // 커스텀 오버레이 초기에 보이도록 설정
    }

    function showInitialOverlays() {
        // 예를 들어 coffeePositions의 첫 번째 오버레이를 보이도록 설정
        overlayList[0].setMap(map);
    }

    // UI 토글 함수
    function toggleUI() {
        var category = document.querySelector('.category');
        var searchForm = document.getElementById('searchForm');
        var toggleButton = document.getElementById('toggleUI');

        if (category.style.display === 'none') {
            category.style.display = 'block';
            searchForm.style.display = 'block';
            toggleButton.innerHTML = 'UI 숨기기';
        } else {
            category.style.display = 'none';
            searchForm.style.display = 'none';
            toggleButton.innerHTML = 'UI 보이기';
        }
    }

    // 지도 초기화
    initMap();
</script>

</body>
</html>
